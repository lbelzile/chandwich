<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Comparison of nested models — compare_models • chandwich</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Comparison of nested models — compare_models" />
<meta property="og:description" content="Compares nested models using the adjusted likelihood ratio test statistic
(ALRTS) described in Section 3.5 of
Chandler and Bate (2007).
The nesting must result from the simple constraint that a subset of the
parameters of the larger model is held fixed." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">chandwich</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/chandwich-vignette.html">Introducing chandwich: Chandler-Bate Loglikelihood Adjustment</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/paulnorthrop/chandwich/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Comparison of nested models</h1>
    <small class="dont-index">Source: <a href='https://github.com/paulnorthrop/chandwich/blob/master/R/compare_models.R'><code>R/compare_models.R</code></a></small>
    <div class="hidden name"><code>compare_models.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compares nested models using the adjusted likelihood ratio test statistic
(ALRTS) described in Section 3.5 of
<a href='http://dx.doi.org/10.1093/biomet/asm015'>Chandler and Bate (2007)</a>.
The nesting must result from the simple constraint that a subset of the
parameters of the larger model is held fixed.</p>
    </div>

    <pre class="usage"><span class='fu'>compare_models</span>(
  <span class='no'>larger</span>,
  <span class='kw'>smaller</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>approx</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"vertical"</span>, <span class='st'>"cholesky"</span>, <span class='st'>"spectral"</span>, <span class='st'>"none"</span>),
  <span class='kw'>fixed_pars</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>fixed_at</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep_len</a></span>(<span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>fixed_pars</span>)),
  <span class='kw'>init</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>larger</th>
      <td><p>An object of class <code>"chandwich"</code> returned by
<code><a href='adjust_loglik.html'>adjust_loglik</a></code>.  The larger of the two models.</p></td>
    </tr>
    <tr>
      <th>smaller</th>
      <td><p>An object of class <code>"chandwich"</code> returned by
  <code><a href='adjust_loglik.html'>adjust_loglik</a></code>.  The smaller of the two models.</p>
<p>If <code>smaller</code> is supplied then the arguments <code>fixed_pars</code> and
  <code>fixed_at</code> described below are ignored.</p></td>
    </tr>
    <tr>
      <th>approx</th>
      <td><p>A logical scalar.  If <code>approx = TRUE</code> then the
  approximation detailed by equations (18)-(20) of Chandler and Bate (2007)
  is used.  This option is available only if <code>smaller</code> is supplied.
  If <code>smaller</code> is not supplied then <code>approx = TRUE</code> is used,
  with no warning.</p>
<p>The approximation doesn't make sense if <code>type = "none"</code>.  If
  <code>type = "none"</code> and <code>approx = TRUE</code> then <code>approx</code> is
  set to <code>FALSE</code> with no warning.</p>
<p>If <code>approx = FALSE</code> then the adjusted likelihood is
  maximised under the restriction imposed by <code>delta</code>, that is,
  equation (17) of Chandler and Bate (2007) is used.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>A character scalar.  The argument <code>type</code> to the function
returned by <code><a href='adjust_loglik.html'>adjust_loglik</a></code>, that is, the type of adjustment
made to the independence loglikelihood function.</p></td>
    </tr>
    <tr>
      <th>fixed_pars</th>
      <td><p>A numeric vector.  Indices of the components of the
<strong>full</strong> parameter vector that are restricted to be equal to the
value(s) in <code>fixed_at</code>.</p></td>
    </tr>
    <tr>
      <th>fixed_at</th>
      <td><p>A numeric vector of length 1 or <code><a href='https://rdrr.io/r/base/length.html'>length(fixed_pars)</a></code>.
If <code>length(fixed_at) = 1</code> then the components <code>fixed_pars</code>
of the parameter vector are all fixed at <code>fixed_at</code>.
If <code>length(fixed_at) = length(fixed_pars)</code> then the component
<code>fixed_pars[i]</code> is fixed at <code>fixed_at[i]</code> for each <code>i</code>.</p></td>
    </tr>
    <tr>
      <th>init</th>
      <td><p>(Only relevant if <code>approx = FALSE</code>).
A numeric vector of initial values for use in the search for
the MLE under the smaller model.  Must have length equal to the number
of parameters in the smaller of the two models being compared.  If
<code>init</code> is not supplied, or it is of the wrong length, then
<code><a href='https://rdrr.io/r/base/attr.html'>attr(smaller, "MLE")</a></code> is used if <code>smaller</code> is supplied and
<code>attr(larger, "MLE")[-fixed_pars]</code> otherwise.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments to be passed to <code><a href='https://rdrr.io/r/stats/optim.html'>optim</a></code>.
These may include <code>gr</code>, <code>method</code>, <code>lower</code>, <code>upper</code>
or <code>control</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class "compmod", a list with components</p>
<dt>alrts</dt><dd><p>the adjusted likelihood ratio test statistic.</p></dd>
 <dt>df</dt><dd><p>under the null hypothesis that the smaller model is a valid
   simplification of the larger model the adjusted likelihood ratio
   test statistic has a chi-squared distribution with <code>df</code>
   degrees of freedom.</p></dd>
 <dt>p_value</dt><dd><p>the p-value associated with the test of the null
   hypothesis.</p></dd>
 <dt>larger_mle</dt><dd><p>the MLE of the parameters under the larger model.</p></dd>
 <dt>smaller_mle</dt><dd><p>the MLE of the parameters under the smaller model.</p></dd>
 <dt>larger_fixed_pars, smaller_fixed_pars</dt><dd><p>Numeric vectors of the
   indices of parameters fixed in the larger and smaller models,
   respectively.</p></dd>
 <dt>larger_fixed_at, smaller_fixed_at</dt><dd><p>Numeric vectors of the
   values at which the parameters in <code>larger_fixed_pars</code> and
   <code>smaller_fixed_pars</code> are fixed.</p></dd>
 <dt>approx</dt><dd><p>the argument <code>approx</code>.</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The smaller of the two models is specified either by supplying
  <code>smaller</code> or <code>fixed_pars</code>.  If both are supplied then
  <code>smaller</code> takes precedence.</p>
<p>For full details see Section 3.5 of
  <a href='http://dx.doi.org/10.1093/biomet/asm015'>Chandler and Bate (2007)</a>.
  if <code>approx = FALSE</code> then the a likelihood ratio test of the null
  hypothesis that the smaller model is a valid simplification of the larger
  model is carried out directly using equation (17) of Chandler and Bate
  (2007) based on the adjusted loglikelihood under the larger model,
  returned by <code>adjust_loglik</code>.  This adjusted loglikelihood is
  maximised subject to the constraint that a subset of the parameters
  in the larger model are fixed.  If <code>smaller</code> is supplied
  then this maximisation can be avoided using an approximation
  detailed by equations (18)-(20) of Chandler and Bate (2007), which uses
  the MLE under the smaller model.  The same null distribution (chi-squared
  with degrees of freedom equal to the number of parameters that are fixed)
  is used in both cases.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Chandler, R. E. and Bate, S. (2007). Inference for clustered
  data using the independence loglikelihood. <em>Biometrika</em>,
  <strong>94</strong>(1), 167-183. <a href='http://dx.doi.org/10.1093/biomet/asm015'>http://dx.doi.org/10.1093/biomet/asm015</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='adjust_loglik.html'>adjust_loglik</a></code> to adjust a user-supplied
  loglikelihood function.</p>
<p><code><a href='conf_intervals.html'>conf_intervals</a></code> for confidence intervals for
  individual parameters.</p>
<p><code><a href='conf_region.html'>conf_region</a></code> for a confidence region for
  pairs of parameters.</p>
<p><code><a href='print.compmod.html'>print.compmod</a></code>.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># -------------------------- GEV model, owtemps data -----------------------</span>
<span class='co'># ------------ following Section 5.2 of Chandler and Bate (2007) -----------</span>

<span class='no'>gev_loglik</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>pars</span>, <span class='no'>data</span>) {
  <span class='no'>o_pars</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>3</span>, <span class='fl'>5</span>)] + <span class='no'>pars</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2</span>, <span class='fl'>4</span>, <span class='fl'>6</span>)]
  <span class='no'>w_pars</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>3</span>, <span class='fl'>5</span>)] - <span class='no'>pars</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2</span>, <span class='fl'>4</span>, <span class='fl'>6</span>)]
  <span class='kw'>if</span> (<span class='fu'><a href='https://rdrr.io/r/base/Logic.html'>isTRUE</a></span>(<span class='no'>o_pars</span>[<span class='fl'>2</span>] <span class='kw'>&lt;=</span> <span class='fl'>0</span> <span class='kw'>|</span> <span class='no'>w_pars</span>[<span class='fl'>2</span>] <span class='kw'>&lt;=</span> <span class='fl'>0</span>)) <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(-<span class='fl'>Inf</span>)
  <span class='no'>o_data</span> <span class='kw'>&lt;-</span> <span class='no'>data</span>[, <span class='st'>"Oxford"</span>]
  <span class='no'>w_data</span> <span class='kw'>&lt;-</span> <span class='no'>data</span>[, <span class='st'>"Worthing"</span>]
  <span class='no'>check</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> + <span class='no'>o_pars</span>[<span class='fl'>3</span>] * (<span class='no'>o_data</span> - <span class='no'>o_pars</span>[<span class='fl'>1</span>]) / <span class='no'>o_pars</span>[<span class='fl'>2</span>]
  <span class='kw'>if</span> (<span class='fu'><a href='https://rdrr.io/r/base/Logic.html'>isTRUE</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span>(<span class='no'>check</span> <span class='kw'>&lt;=</span> <span class='fl'>0</span>))) <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(-<span class='fl'>Inf</span>)
  <span class='no'>check</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span> + <span class='no'>w_pars</span>[<span class='fl'>3</span>] * (<span class='no'>w_data</span> - <span class='no'>w_pars</span>[<span class='fl'>1</span>]) / <span class='no'>w_pars</span>[<span class='fl'>2</span>]
  <span class='kw'>if</span> (<span class='fu'><a href='https://rdrr.io/r/base/Logic.html'>isTRUE</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span>(<span class='no'>check</span> <span class='kw'>&lt;=</span> <span class='fl'>0</span>))) <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(-<span class='fl'>Inf</span>)
  <span class='no'>o_loglik</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='log_gev.html'>log_gev</a></span>(<span class='no'>o_data</span>, <span class='no'>o_pars</span>[<span class='fl'>1</span>], <span class='no'>o_pars</span>[<span class='fl'>2</span>], <span class='no'>o_pars</span>[<span class='fl'>3</span>])
  <span class='no'>w_loglik</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='log_gev.html'>log_gev</a></span>(<span class='no'>w_data</span>, <span class='no'>w_pars</span>[<span class='fl'>1</span>], <span class='no'>w_pars</span>[<span class='fl'>2</span>], <span class='no'>w_pars</span>[<span class='fl'>3</span>])
  <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='no'>o_loglik</span> + <span class='no'>w_loglik</span>)
}

<span class='co'># Initial estimates (method of moments for the Gumbel case)</span>
<span class='no'>sigma</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fl'>6</span> * <span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>var</a></span>(<span class='no'>owtemps</span>))) / <span class='no'>pi</span>)
<span class='no'>mu</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colMeans</a></span>(<span class='no'>owtemps</span>) - <span class='fl'>0.57722</span> * <span class='no'>sigma</span>)
<span class='no'>init</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>mu</span>), -<span class='fu'><a href='https://rdrr.io/r/base/diff.html'>diff</a></span>(<span class='no'>mu</span>) / <span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>sigma</span>), -<span class='fu'><a href='https://rdrr.io/r/base/diff.html'>diff</a></span>(<span class='no'>sigma</span>) / <span class='fl'>2</span>, <span class='fl'>0</span>, <span class='fl'>0</span>)

<span class='co'># Log-likelihood adjustment of the full model</span>
<span class='no'>par_names</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"mu[0]"</span>, <span class='st'>"mu[1]"</span>, <span class='st'>"sigma[0]"</span>, <span class='st'>"sigma[1]"</span>, <span class='st'>"xi[0]"</span>, <span class='st'>"xi[1]"</span>)
<span class='no'>large</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='adjust_loglik.html'>adjust_loglik</a></span>(<span class='no'>gev_loglik</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>owtemps</span>, <span class='kw'>init</span> <span class='kw'>=</span> <span class='no'>init</span>,
         <span class='kw'>par_names</span> <span class='kw'>=</span> <span class='no'>par_names</span>)

<span class='co'># Log-likelihood adjustment of some smaller models: xi[1] = 0 etc</span>

<span class='no'>medium</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='adjust_loglik.html'>adjust_loglik</a></span>(<span class='kw'>larger</span> <span class='kw'>=</span> <span class='no'>large</span>, <span class='kw'>fixed_pars</span> <span class='kw'>=</span> <span class='st'>"xi[1]"</span>)
<span class='no'>small</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='adjust_loglik.html'>adjust_loglik</a></span>(<span class='kw'>larger</span> <span class='kw'>=</span> <span class='no'>medium</span>, <span class='kw'>fixed_pars</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"sigma[1]"</span>, <span class='st'>"xi[1]"</span>))

<span class='co'># Tests</span>

<span class='co'># Test xi1 = 0 (2 equivalent ways), vertical adjustment</span>
<span class='fu'>compare_models</span>(<span class='no'>large</span>, <span class='kw'>fixed_pars</span> <span class='kw'>=</span> <span class='st'>"xi[1]"</span>)</div><div class='output co'>#&gt; Model: gev_loglik 
#&gt; H0: "xi[1]" = 0 
#&gt; HA: unrestricted model 
#&gt; 
#&gt; test statistic = 6.356, df = 1, p-value = 0.0117</div><div class='input'><span class='fu'>compare_models</span>(<span class='no'>large</span>, <span class='no'>medium</span>)</div><div class='output co'>#&gt; Model: gev_loglik 
#&gt; H0: "xi[1]" = 0 
#&gt; HA: unrestricted model 
#&gt; 
#&gt; test statistic = 6.356, df = 1, p-value = 0.0117</div><div class='input'><span class='co'># Test xi1 = 0, using approximation</span>
<span class='fu'>compare_models</span>(<span class='no'>large</span>, <span class='no'>medium</span>, <span class='kw'>approx</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; Model: gev_loglik 
#&gt; H0: "xi[1]" = 0 
#&gt; HA: unrestricted model 
#&gt; 
#&gt; Using using approximation (18) of Chandler and Bate (2007): 
#&gt; test statistic = 5.245, df = 1, p-value = 0.022</div><div class='input'>
<span class='co'># Horizontal adjustments</span>
<span class='fu'>compare_models</span>(<span class='no'>large</span>, <span class='no'>medium</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"cholesky"</span>)$<span class='no'>p_value</span></div><div class='output co'>#&gt; [1] 0.01593336</div><div class='input'><span class='fu'>compare_models</span>(<span class='no'>large</span>, <span class='no'>medium</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"spectral"</span>)$<span class='no'>p_value</span></div><div class='output co'>#&gt; [1] 0.01229833</div><div class='input'><span class='co'># No adjustment (independence loglikelihood)</span>
<span class='fu'>compare_models</span>(<span class='no'>large</span>, <span class='no'>medium</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"none"</span>)$<span class='no'>p_value</span></div><div class='output co'>#&gt; [1] 0.074199</div><div class='input'>
<span class='co'># Test sigma1 = 0 for model with xi1 = 0</span>
<span class='fu'>compare_models</span>(<span class='no'>medium</span>, <span class='no'>small</span>)</div><div class='output co'>#&gt; Model: gev_loglik 
#&gt; H0: ("sigma[1]", "xi[1]") = (0, 0) 
#&gt; HA: "xi[1]" = 0 
#&gt; 
#&gt; test statistic = 4.251, df = 1, p-value = 0.03924</div><div class='input'><span class='co'># Test sigma1 = xi1 = 0</span>
<span class='fu'>compare_models</span>(<span class='no'>large</span>, <span class='no'>small</span>)</div><div class='output co'>#&gt; Model: gev_loglik 
#&gt; H0: ("sigma[1]", "xi[1]") = (0, 0) 
#&gt; HA: unrestricted model 
#&gt; 
#&gt; test statistic = 8.6, df = 2, p-value = 0.01357</div><div class='input'>
<span class='co'># --------- Misspecified Poisson model for negative binomial data ----------</span>

<span class='co'># ... following Section 5.1 of the "Object-Oriented Computation of Sandwich</span>
<span class='co'># Estimators" vignette of the sandwich package</span>
<span class='co'># https://cran.r-project.org/web/packages/sandwich/vignettes/sandwich-OOP.pdf</span>

<span class='co'># Simulate data</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>123</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fl'>250</span>)
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/NegBinomial.html'>rnbinom</a></span>(<span class='fl'>250</span>, <span class='kw'>mu</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span>(<span class='fl'>1</span> + <span class='no'>x</span>), <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>1</span>)
<span class='co'># Fit misspecified Poisson model</span>
<span class='no'>fm_pois</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span>(<span class='no'>y</span> ~ <span class='no'>x</span> + <span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span>(<span class='no'>x</span>^<span class='fl'>2</span>), <span class='kw'>family</span> <span class='kw'>=</span> <span class='no'>poisson</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>fm_pois</span>)$<span class='no'>coefficients</span></div><div class='output co'>#&gt;                Estimate Std. Error   z value      Pr(&gt;|z|)
#&gt; (Intercept)  1.06326821 0.04135723 25.709367 9.184267e-146
#&gt; x            0.99607219 0.05353446 18.606186  2.862861e-77
#&gt; I(x^2)      -0.04912373 0.02314608 -2.122335  3.380961e-02</div><div class='input'>
<span class='co'># Contributions to the independence loglikelihood</span>
<span class='no'>pois_glm_loglik</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>pars</span>, <span class='no'>y</span>, <span class='no'>x</span>) {
  <span class='no'>log_mu</span> <span class='kw'>&lt;-</span> <span class='no'>pars</span>[<span class='fl'>1</span>] + <span class='no'>pars</span>[<span class='fl'>2</span>] * <span class='no'>x</span> + <span class='no'>pars</span>[<span class='fl'>3</span>] * <span class='no'>x</span> ^ <span class='fl'>2</span>
  <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Poisson.html'>dpois</a></span>(<span class='no'>y</span>, <span class='kw'>lambda</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span>(<span class='no'>log_mu</span>), <span class='kw'>log</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))
}
<span class='no'>pars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"alpha"</span>, <span class='st'>"beta"</span>, <span class='st'>"gamma"</span>)
<span class='no'>pois_quad</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='adjust_loglik.html'>adjust_loglik</a></span>(<span class='no'>pois_glm_loglik</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>y</span>, <span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>par_names</span> <span class='kw'>=</span> <span class='no'>pars</span>)
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>pois_quad</span>)</div><div class='output co'>#&gt;            MLE      SE adj. SE
#&gt; alpha  1.06300 0.04136 0.08378
#&gt; beta   0.99610 0.05354 0.10520
#&gt; gamma -0.04913 0.02315 0.03628</div><div class='input'>
<span class='no'>pois_lin</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='adjust_loglik.html'>adjust_loglik</a></span>(<span class='kw'>larger</span> <span class='kw'>=</span> <span class='no'>pois_quad</span>, <span class='kw'>fixed_pars</span> <span class='kw'>=</span> <span class='st'>"gamma"</span>)

<span class='co'># Test the significance of the quadratic term</span>
<span class='fu'>compare_models</span>(<span class='no'>pois_quad</span>, <span class='no'>pois_lin</span>)$<span class='no'>p_value</span></div><div class='output co'>#&gt; [1] 0.1772841</div><div class='input'><span class='fu'>compare_models</span>(<span class='no'>pois_quad</span>, <span class='no'>pois_lin</span>, <span class='kw'>approx</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)$<span class='no'>p_value</span></div><div class='output co'>#&gt; [1] 0.1657919</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Paul J. Northrop, Richard E. Chandler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


